<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's Get Funky | ME 218a Team 14</title>
    <style>
        /* --- STEAMPUNK THEME CSS --- */
        :root {
            --brass: #b5a642;
            --copper: #b87333;
            --dark-wood: #2b1d0e;
            --parchment: #fdf5e6;
            --gear-grey: #4a4a4a;
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--parchment);
            color: var(--dark-wood);
            margin: 0;
            line-height: 1.6;
            background-image: repeating-linear-gradient(45deg, #fdf5e6 0, #fdf5e6 10px, #fcf0da 10px, #fcf0da 20px);
        }

        /* NAVIGATION */
        nav {
            background-color: var(--dark-wood);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 4px solid var(--brass);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav li { margin: 0; }

        nav a {
            display: block;
            padding: 15px 20px;
            color: var(--brass);
            text-decoration: none;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            transition: background 0.3s;
        }

        nav a:hover {
            background-color: var(--copper);
            color: #fff;
        }

        /* HEADER */
        header {
            text-align: center;
            padding: 60px 20px;
            background: radial-gradient(circle, var(--dark-wood), #000);
            color: var(--brass);
            border-bottom: 5px solid var(--copper);
        }

        header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px #000;
        }

        header h2 {
            font-family: 'Courier New', monospace;
            color: #fff;
            font-size: 1.5rem;
        }

        /* CONTENT SECTIONS */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        section {
            background: #fff;
            padding: 30px;
            margin-bottom: 40px;
            border: 2px solid var(--dark-wood);
            box-shadow: 10px 10px 0px var(--gear-grey);
            position: relative;
        }

        /* Corner screws effect */
        section::before, section::after {
            content: '+';
            position: absolute;
            color: var(--brass);
            font-weight: bold;
            font-size: 20px;
        }
        section::before { top: 5px; left: 10px; }
        section::after { top: 5px; right: 10px; }

        h3 {
            border-bottom: 3px double var(--copper);
            padding-bottom: 10px;
            color: var(--dark-wood);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h4 { color: var(--copper); margin-top: 25px; font-weight: bold;}

        /* LISTS */
        ul.styled-list {
            list-style-type: square;
            color: var(--dark-wood);
        }
        ul.styled-list li {
            margin-bottom: 10px;
        }
        
        /* TEAM GRID */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .team-member img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid var(--brass);
            object-fit: cover;
            background-color: #ddd; /* Placeholder color */
        }
        
        .team-member h5 { margin: 10px 0 5px 0; font-size: 1.1rem; }
        .team-member p { margin: 0; font-size: 0.9rem; color: #666; }

        /* VIDEO PLACEHOLDER */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            background: #000;
            border: 4px solid var(--brass);
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* DIAGRAM IMAGES */
        .diagram-img {
            width: 100%;
            height: auto;
            border: 2px solid var(--gear-grey);
            margin: 20px 0;
        }
        
        /* TABLE STYLES */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        th, td {
            border: 1px solid var(--dark-wood);
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: var(--dark-wood);
            color: var(--brass);
        }

        tr:nth-child(even) { background-color: #f2f2f2; }
        
        /* PSEUDOCODE / DETAILS STYLES */
        details.service-block {
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: hidden;
            background-color: #f4f4f4;
        }
        
        summary.service-title {
            background-color: var(--dark-wood);
            color: var(--brass);
            padding: 12px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            list-style: none; /* Hide default arrow */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Custom arrow indicator */
        summary.service-title::after {
            content: '+';
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        details[open] summary.service-title::after {
            content: '-';
        }
        
        summary.service-title:hover {
            background-color: #3e2b16;
        }
        
        /* Remove default marker for Chrome/Safari */
        summary.service-title::-webkit-details-marker {
            display: none;
        }

        .pseudocode-box {
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 0.9rem;
            color: #333;
            border-top: 2px solid var(--copper);
            background-color: #fcfcfc;
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--dark-wood);
            color: #888;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

<nav>
    <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#interaction">Interaction</a></li>
        <li><a href="#mechanical">Mechanical</a></li>
        <li><a href="#electrical">Electrical</a></li>
        <li><a href="#software">Software</a></li>
        <li><a href="#team">Team</a></li>
        <li><a href="#bom">BOM</a></li>
        <li><a href="#gems">Gems</a></li>
    </ul>
</nav>

<header>
    <h1>Let's Get Funky</h1>
    <h2>A Steampunk-Themed Carnival Game</h2>
    <p>ME 218a Fall 2025 | Stanford University</p>
</header>

<div class="container">

    <section id="video">
        <h3>System Demonstration</h3>
        <p>Watch the "Let's Get Funky" engine in operation.</p>
        <div class="video-container">
            <iframe src="https://www.youtube.com/embed/PLACEHOLDER_ID" title="Project Video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </section>

    <section id="overview">
        <h3>Project Description</h3>
        <p>Our team was tasked to design and build a Steampunk-Themed Carnival Game, a "Temporal Entertainment Module" (TEM), that bridges the gap between past and future. From this, we present "Let's Get Funky," a mechanical pinball machine embodying the industrial spirit of the 1800s.</p>
        
        <h4>How it Works</h4>
        <p>When powered on, Let's Get Funky initializes in a WELCOME mode shown on the LED display. Once the START button is pressed, the system transitions to the READY state. The player initiates gameplay by pulling the LAUNCH plunger. A sensor detects the ball's entry into the playfield, triggering the ACTIVE state.</p>
        
        <p>During the game, a 60-second timer counts down. Players must use the flippers to strike targets or navigate the ramp to accumulate points. The points for hitting the target are force sensitive, the harder you hit it, the more points you get.</p>
        
        <p>To accommodate difficulty, the system includes a "Ball Save" feature: if the ball drains within the first 30 seconds, it can be returned to play. After 30 seconds, losing the ball results in an immediate GAME OVER.</p>
        
        <p>The system monitors user input for inactivity. If no activity is detected for 20 seconds—defined as staying in the READY state without launching, or in the ACTIVE state without scoring or losing the ball—the game automatically resets to the WELCOME state.</p>
    </section>

    <section id="interaction">
        <h3>User Interaction</h3>
        
        <h4>User Inputs</h4>
        <p>The game offers 4 modes of user interaction. After pressing the start button to start the game, the user launches the ball, uses the flippers and hits targets to gain points until the ball is lost.</p>
        <ul class="styled-list">
            <li><strong>Start button:</strong> Button to start the game.</li>
            <li><strong>Flippers:</strong> Buttons to move the flippers.</li>
            <li><strong>Target hits:</strong> Targets to gain points.</li>
            <li><strong>Ball sensing:</strong> Sensors for launched, lost and slide ball.</li>
        </ul>
        <p></p>

        <h4>User Feedback</h4>
        <p>The game provides feedback through three channels:</p>
        <ul class="styled-list">
            <li><strong>Visually:</strong> The LED display indicates the game mode, remaining time, and score.</li>
            <li><strong>Auditorily:</strong> The game plays thematic music during gameplay and a specific alert to signal the end of the round.</li>
            <li><strong>Haptically:</strong> The player receives vibrational feedback whenever a target is hit, incentivizing strong impacts and confirming scores.</li>
        </ul>
        <p></p>
    </section>

    <section id="mechanical">
        <h3>Mechanical Design</h3>
        <p>The mechanical system was developed in parallel to the electrical and software aspects of the project. The design goals focused on two critical requirements: component integration and player ergonomics.</p>
        
        <p>The game was modeled using OnShape and manufactured with the help of Lab64 and other on-campus facilities. The enclosure was laser cut from 1/8" plywood and 1/4" plywood, and assembled using wood glue.</p>
        
        <p>All other custom components (i.e. the flippers, plunger, slide, and gear dispenser) were 3D printed out of PLA.</p>
    </section>

    <section id="electrical">
        <h3>Electrical Design</h3>
        <img src="schematic.png" alt="Circuit Schematic" class="diagram-img">
        
        <p>The electrical system bridges the 3.3V logic of the PIC32 with high-power 5V peripherals. Key components include:</p>
        <ul class="styled-list">
            <li><strong>Microcontroller:</strong> PIC32MX170F256B running at 20MHz.</li>
            <li><strong>Sensors:</strong> TSSP58038 IR receivers for ball tracking and Piezo elements for force-sensitive targets.</li>
            <li><strong>Actuators:</strong> Servos for gear dispensing and DC motors for vibration feedback.</li>
            <li><strong>Audio:</strong> JQ6500 Voice Module for sound effects.</li>
            <li><strong>Drivers:</strong> IRF520 MOSFETs to drive high-current loads like motors and solenoids.</li>
        </ul>
    </section>

    <section id="software">
        <h3>Software Design</h3>
        <p>The system runs on the Gen2 Events & Services Framework using a hierarchical state machine approach. Click on the services below to view the logical pseudocode.</p>

        <img src="fsm.png" alt="Finite State Machine Diagram" class="diagram-img">
        

[Image of Finite State Machine Diagram]


        <details class="service-block">
            <summary class="service-title">PinballService (Master State Machine)</summary>
            <div class="pseudocode-box">
Function RunPinballService(Event):
  Switch CurrentState:
    Case STATE_WELCOME:
      If Event is START_BUTTON_PRESSED:
        Reset Score to 0
        Start Inactivity Timer (20s)
        Transition to STATE_READY
        Post "READY" to LED

    Case STATE_READY:
      If Event is LAUNCH_BUTTON or IR_LAUNCH:
        Initialize Game Timer (60s)
        Initialize Display Timer (1s)
        Set LED Mode to SPLIT (Score + Timer)
        Transition to STATE_GAME_IN_PLAY
      If Event is TIMEOUT (Inactivity):
        Start Timeout Delay Timer (5s)
        Transition to STATE_TIMEOUT

    Case STATE_GAME_IN_PLAY:
      If Event is IR_SCORE or PIEZO_TRIPPED:
        Increment Score
        Reset Inactivity Timer
      If Event is TIMER_EXPIRED (1 sec):
        Decrement Game Time
        Update Static LED Buffer (Timer digits)
      If Event is GAME_OVER (Time up or Ball Lost):
        Stop all Game Timers
        Post ES_TEST_SERVO_DISPENSE (with Score)
        Transition to STATE_GAME_OVER
        Post "GAME OVER" to LED
      If Event is INACTIVITY_TIMEOUT:
        If Flipper is Held: Reset Timer (Keep Playing)
        Else: Trigger GAME_OVER

    Case STATE_GAME_OVER:
      If Completion Timer Expires:
        Transition to STATE_WELCOME
        Post "WELCOME" to LED
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">LEDService (Display Driver)</summary>
            <div class="pseudocode-box">
Function RunLEDService(Event):
  Switch CurrentState:
    Case IDLE:
      If Event is ADD_CHAR:
        If Mode is FULL: Scroll entire buffer, add char to end
        If Mode is SPLIT: Scroll modules 2-4 only, add char to module 2
        Trigger UPDATE_ROW Event
      If Event is UPDATE_STATIC_BUFFER:
        Update module 1 (Timer) directly without scrolling

    Case UPDATE:
      If Event is UPDATE_ROW:
        Call HAL function DM_TakeDisplayUpdateStep()
        If HAL reports "Done":
          Return to IDLE state
        Else:
          Re-post UPDATE_ROW to self (Keep pushing bits)
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">ServoService (Actuators)</summary>
            <div class="pseudocode-box">
Function RunServoService(Event):
  If Event is INIT:
    Set PWM Pulse Width to Middle (Neutral) for both servos

  If Event is TEST_SERVO_DISPENSE:
    Set PWM Pulse Width to Minimum (Push Gear)
    Start Servo Timer (2 seconds)

  If Event is TEST_SERVO_DECOR:
    Set PWM Pulse Width to Target
    Start Servo Timer (2 seconds)

  If Event is TIMEOUT:
    Set PWM Pulse Width back to Middle (Retract)
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">SoundService (Audio via UART)</summary>
            <div class="pseudocode-box">
Function RunSoundService(Event):
  If Event is START_BUTTON_PRESSED:
    Send UART Command: Play Track [START_SOUND]
  
  If Event is FLIPPER_PRESSED:
    Send UART Command: Play Track [FLIPPER_SOUND]

  If Event is SCORE or PIEZO_TRIPPED:
    Send UART Command: Play Track [HIT_SOUND]

Helper JQ6500_SendCommand:
  Send 0x7E (Start Byte)
  Send Length, Command, and Parameters
  Send 0xEF (End Byte)
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">IRSensorService (Input Polling)</summary>
            <div class="pseudocode-box">
Function RunIRSensorService(Event):
  If Event is TIMER_TIMEOUT (10ms Poll):
    Read Pins (Launch, Score, Loss)
    
    For Each Sensor:
      If Pin is HIGH (Beam Broken) AND State was LOW:
        State = WAITING
        Post Event (e.g., ES_IR_LAUNCH_TRIPPED) to Master
      Else If Pin is LOW (Beam Clear):
        State = LOW
        
    Restart Poll Timer (10ms)
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">PiezoService (Analog Input)</summary>
            <div class="pseudocode-box">
Function RunPiezoService(Event):
  If Event is TIMER_TIMEOUT (10ms):
    If NOT InCooldown:
      Read ADC Value
      If Value > THRESHOLD:
        Post ES_PIEZO_TRIPPED to Master
        Set InCooldown = TRUE
        Start Cooldown Timer (150ms)
    Restart Poll Timer
    
  If Event is COOLDOWN_TIMER_EXPIRED:
    Set InCooldown = FALSE
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">VibrationService (Haptics)</summary>
            <div class="pseudocode-box">
Function RunVibrationService(Event):
  If Event is ES_VIBRATION:
    Set Output Pin HIGH (Motor On)
    Start Duration Timer (150ms)
    State = VIBRATING

  If Event is TIMER_EXPIRED:
    Set Output Pin LOW (Motor Off)
    State = IDLE
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">DM_Display (Hardware Abstraction Layer)</summary>
            <div class="pseudocode-box">
Function DM_TakeInitDisplayStep():
  Sequence through init states:
  1. Send Shutdown Command
  2. Clear Memory
  3. Disable Code-B Decoding
  4. Enable Scan Limit
  5. Set Brightness
  6. Wake Up (End Shutdown)

Function DM_TakeDisplayUpdateStep():
  Send one row of data to MAX7219 via SPI
  Increment Row Counter
  If Row Counter >= 8: Return TRUE (Frame Complete)
  Else: Return FALSE
            </div>
        </details>

        <details class="service-block">
            <summary class="service-title">IREmitterService (Hardware Setup)</summary>
            <div class="pseudocode-box">
Function InitIREmitterService():
  Configure Timer 3
  Set Frequency to 38kHz
  Map Output Channel to Pin RB13
  Set Duty Cycle to 50%
  Enable Output
            </div>
        </details>
        
    </section>

    <section id="team">
        <h3>Team</h3>
        <div class="team-grid">
            <div class="team-member">
                <img src="clive.jpg" alt="Clive Chung"> 
                <h5>Clive Chung</h5>
            </div>
            <div class="team-member">
                <img src="ke.jpg" alt="Ke Ou">
                <h5>Ke Ou</h5>
            </div>
            <div class="team-member">
                <img src="maroussia.jpg" alt="Maroussia Walckiers">
                <h5>Maroussia Walckiers</h5>
                <p>BS-BME Stanford '25, MSME '26</p>
            </div>
        </div>
    </section>

    <section id="bom">
        <h3>Bill of Materials</h3>
        <p>The total project cost was approximately <strong>$175.56</strong>.</p>
        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Count</th>
                    <th>Supplier</th>
                    <th>Cost</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Hitec HS-322HD Servo</td>
                    <td>2</td>
                    <td>AMPS</td>
                    <td>$38.00</td>
                </tr>
                <tr>
                    <td>EG STARTS Arcade Button</td>
                    <td>1</td>
                    <td>SPDL</td>
                    <td>$1.00</td>
                </tr>
                <tr>
                    <td>Steel Pinball</td>
                    <td>1</td>
                    <td>SPDL</td>
                    <td>$6.00</td>
                </tr>
                <tr>
                    <td>Spring Assortment Kit</td>
                    <td>3</td>
                    <td>SPDL</td>
                    <td>$8.00</td>
                </tr>
                <tr>
                    <td>Hardware (Screws)</td>
                    <td>14</td>
                    <td>SPDL/AMPS</td>
                    <td>$13.00</td>
                </tr>
                 <tr>
                    <td>1/4" Plywood (2x4' and 4x8')</td>
                    <td>4</td>
                    <td>Home Depot</td>
                    <td>$60.00</td>
                </tr>
                <tr>
                    <td>PIC32MX170F256B</td>
                    <td>1</td>
                    <td>Lab Kit</td>
                    <td>$0.00</td>
                </tr>
                <tr>
                    <td>MAX7219 Dot Matrix</td>
                    <td>1</td>
                    <td>Lab Kit</td>
                    <td>$0.00</td>
                </tr>
                <tr>
                    <td>Misc Electronics (LM339N, MCP6294)</td>
                    <td>2</td>
                    <td>Lab Kit</td>
                    <td>$0.00</td>
                </tr>
                <tr>
                    <td>Speaker (8 Ohm 1 Watt)</td>
                    <td>1</td>
                    <td>SPDL</td>
                    <td>$2.00</td>
                </tr>
                <tr>
                    <td>Piezo Discs (12pcs) </td>
                    <td>1</td>
                    <td>Amazon</td>
                    <td>$7.74</td>
                </tr>
                <tr>
                    <td>IR Sensor Kit (4 pairs)</td>
                    <td>1</td>
                    <td>Amazon</td>
                    <td>$8.85</td>
                </tr>
                <tr>
                    <td>JQ6500 Voice Module (2pcs)</td>
                    <td>1</td>
                    <td>Amazon</td>
                    <td>$12.17</td>
                </tr>
                <tr>
                    <td>Vibration Motors (20pcs)</td>
                    <td>1</td>
                    <td>Amazon</td>
                    <td>$11.06</td>
                </tr>
                <tr>
                    <td>IRF520 MOSFET Modules (5pcs)</td>
                    <td>1</td>
                    <td>Amazon</td>
                    <td>$7.74</td>
                </tr>
                <tr>
                    <td><strong>TOTAL</strong></td>
                    <td></td>
                    <td></td>
                    <td><strong>$175.56</strong></td>
                </tr>
            </tbody>
        </table>
        <p><a href="https://docs.google.com/spreadsheets/d/1muiBZHbCsakAO4bE_VL7oPqp21OFci2PAbMDRD0AnU0/edit?gid=0#gid=0">View Full BOM Spreadsheet</a></p>
    </section>

    <section id="gems">
        <h3>Gems of Wisdom</h3>
        <ul class="styled-list">
            <li>As you advance in your project, make sure to update your electrical schematics and bill of materials.</li>
            <li>Make sure to comment your code thoroughly to make each others life easier.</li>
            <li>Ask questions! Do not hesitate to ask classmates or even friends that do not have anything to do with your project. Every insight is helpful for debugging, design and ideation.</li>
        </ul>
    </section>

</div>

<footer>
    <p><strong>Team 14</strong> | ME 218a 2025</p>
</footer>

</body>
</html>